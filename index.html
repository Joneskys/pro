<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Professional Trading Dashboard</title>

<style>
:root{
  --bg:#050b1a;
  --panel:#0b1633;
  --panel2:#0f1e44;
  --text:#e8f0ff;
  --green:#00e676;
  --red:#ff5252;
  --orange:#ff9800;
  --border:#1b2f63;
}

*{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto}
body{margin:0;background:radial-gradient(circle,#081636,#020611);color:var(--text)}

.container{padding:20px}
h1{margin-bottom:20px}

.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
.card{background:linear-gradient(145deg,#0c1a38,#050c1e);padding:20px;border-radius:18px;text-align:center;box-shadow:0 10px 40px #000}
.card p{font-size:22px;font-weight:bold}

.controls{display:flex;flex-wrap:wrap;gap:10px;margin:20px 0}
input,select,button{
  background:#0c1c3a;
  color:white;
  border:1px solid var(--border);
  padding:10px 14px;
  border-radius:10px;
}
button:hover{cursor:pointer;background:#132a5e}

.tablewrap{overflow-x:auto;border-radius:16px}
table{width:100%;border-collapse:collapse;background:#071126}
thead{background:#0d1c3f;position:sticky;top:0}
th,td{padding:10px;text-align:center;font-size:13px;border-bottom:1px solid #122654}

.buy{color:var(--green);font-weight:bold}
.sell{color:var(--red);font-weight:bold}
.hold{color:#ddd;font-weight:bold}

.badge{padding:4px 10px;border-radius:12px;font-size:12px}
.up{background:#003d1f;color:var(--green)}
.down{background:#3b0000;color:var(--red)}
.side{background:#3a2500;color:var(--orange)}

.modal{
 position:fixed;inset:0;background:#000a;display:none;
 align-items:center;justify-content:center;z-index:1000
}
.tradebox{
 background:#071631;padding:30px;border-radius:20px;width:380px;
 box-shadow:0 0 60px #000
}
.tradebox h2{text-align:center}
.tradebox input{width:100%;margin:5px 0}
.ratio{font-size:26px;font-weight:bold;margin-top:10px}
.green{color:var(--green)}
.red{color:var(--red)}
</style>
</head>

<body>
<div class="container">
<h1>ðŸ“Š Professional Trading Dashboard</h1>

<div class="cards">
  <div class="card"><h3>Gold 24K 10g</h3><p id="gold">â‚¹--</p></div>
  <div class="card"><h3>Silver 1kg</h3><p id="silver">â‚¹--</p></div>
  <div class="card"><h3>Copper</h3><p id="copper">â‚¹--</p></div>
  <div class="card"><h3>USD â†’ INR</h3><p id="usd">â‚¹--</p></div>
</div>

<div class="controls">
  <input type="date">
  <button onclick="loadAll()">Submit</button>
  <input placeholder="Search stock" oninput="search=this.value.toUpperCase();render()">
  <button onclick="filter='BUY';render()">Only Buy</button>
  <button onclick="filter='SELL';render()">Only Sell</button>
  <button onclick="filter='ALL';render()">All</button>
  <select onchange="sort=this.value;render()">
    <option value="">Sort</option>
    <option value="price">Price â†“</option>
    <option value="rsi">RSI â†“</option>
    <option value="vol">Volume â†“</option>
  </select>
  <input id="addStockInput" placeholder="Add stock (INFY)">
  <button onclick="addStock()">Add</button>
</div>

<div id="time">Last refresh: --</div>

<div class="tablewrap">
<table>
<thead>
<tr>
<th>Stock</th><th>Live</th><th>RSI</th><th>Vol(L)</th>
<th>Signal</th><th>Entry</th><th>SL</th><th>Target</th><th>Trade</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>
</div>

<!-- Trade Modal -->
<div class="modal" id="tradeModal">
<div class="tradebox">
<h2 id="tstock"></h2>
<label>Buy</label><input id="entry">
<label>SL</label><input id="sl">
<label>Target</label><input id="tgt">
<label>Quantity</label><input id="qty" oninput="syncBudget()">
<label>Budget</label><input id="budget" oninput="syncQty()">
<button onclick="calcTrade()">Calculate</button>
<div id="result"></div>
<button onclick="closeTrade()">Close</button>
</div>
</div>

<script>
const worker="https://red-tooth-e4f7.lovelyideas-in.workers.dev";
let stocks=["NIFTYBEES","TATAGOLD","TATSILVER","HINDCOPPER","BSE","SAGILITY","CUPID","IDEA","BHARATCOAL","JPPOWER","HDFCBANK","SBIN","MON100","MEESHO","RVNL","ORIENTTECH","HARAFIN","RBLBANK","IRIS","GREAVESCOT","NTPCGREEN","TCS","KIMS"];
let data={},filter="ALL",sort="",search="";

const r2=x=>Math.round(x*20)/20;

async function loadStock(s){
 try{
  const r=await fetch(worker+"/quote?symbol="+s);
  const j=await r.json();
  const p=j.price||Math.random()*300+50;
  const rsi=Math.random()*100;
  const vol=Math.random()*300;
  const sig=rsi<35?"BUY":rsi>65?"SELL":"HOLD";
  const e=r2(p);
  const sl=r2(sig=="BUY"?e*0.985:e*1.015);
  const tgt=r2(sig=="BUY"?e*1.03:e*0.97);
  data[s]={p,rsi,vol,sig,e,sl,tgt};
 }catch{}
}

function render(){
 let arr=Object.entries(data);
 if(search) arr=arr.filter(([s])=>s.includes(search));
 if(filter!="ALL") arr=arr.filter(([_,d])=>d.sig==filter);
 if(sort=="price") arr.sort((a,b)=>b[1].p-a[1].p);
 if(sort=="rsi") arr.sort((a,b)=>b[1].rsi-a[1].rsi);
 if(sort=="vol") arr.sort((a,b)=>b[1].vol-a[1].vol);

 document.getElementById("tbody").innerHTML=arr.map(([s,d])=>`
<tr>
<td class="${d.sig.toLowerCase()}">${s}</td>
<td>${d.p.toFixed(2)}</td>
<td>${d.rsi.toFixed(1)}</td>
<td>${Math.floor(d.vol)}</td>
<td class="${d.sig.toLowerCase()}">${d.sig}</td>
<td>${d.e}</td><td>${d.sl}</td><td>${d.tgt}</td>
<td><button onclick="openTrade('${s}',${d.e},${d.sl},${d.tgt})">Trade</button></td>
</tr>`).join("");
}

function openTrade(s,e,sl,t){
 tradeModal.style.display="flex";
 tstock.innerText=s;
 entry.value=e;this.sl.value=sl;tgt.value=t;
 qty.value="";budget.value="";result.innerHTML="";
}

function closeTrade(){tradeModal.style.display="none"}

function syncQty(){
 let e=+entry.value;
 if(!budget.value||!e)return;
 qty.value=Math.floor(budget.value/e);
}
function syncBudget(){
 let e=+entry.value,q=+qty.value;
 if(!q||!e)return;
 budget.value=(q*e).toFixed(0);
}

function calcTrade(){
 let e=+entry.value,slv=+sl.value,tv=+tgt.value,q=+qty.value;
 let loss=(slv-e)*q;
 let profit=(tv-e)*q;
 let rr=(profit/Math.abs(loss)).toFixed(2);
 result.innerHTML=`
 <div class="red">SL P/L: â‚¹${loss.toFixed(2)}</div>
 <div class="green">Target P/L: â‚¹${profit.toFixed(2)}</div>
 <div class="ratio ${profit>Math.abs(loss)?'green':'red'}">R:R ${rr}</div>`;
}

function addStock(){
 let v=addStockInput.value.toUpperCase();
 if(v&&!stocks.includes(v)){stocks.push(v);loadStock(v).then(render);}
}

async function loadMCX(){
 const map={gold:"GOLD",silver:"SILVER",copper:"COPPER",usd:"USDINR"};
 for(let id in map){
  try{
   let r=await fetch(worker+"/mcx?symbol="+map[id]);
   let j=await r.json();
   let p=j?.chart?.result?.[0]?.meta?.regularMarketPrice;
   document.getElementById(id).innerText=p?`â‚¹${p.toFixed(2)}`:"â‚¹--";
  }catch{}
 }
}

async function loadAll(){
 for(let s of stocks) await loadStock(s);
 render();
 time.innerText="Last refresh: "+new Date().toLocaleTimeString();
}

loadAll();loadMCX();
setInterval(()=>{loadAll();loadMCX()},60000);
</script>
</body>
</html>
